<!DOCTYPE html>
<html>
  <head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>posting tool for DS-Forum v2.0</title>
		<link type="text/css" href="css/ui-darkness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />
    <link type="text/css" href="css/posttool_2_0.css" rel="stylesheet" />
		<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.8.16.custom.min.js"></script>
    <script type="text/javascript" language="JavaScript" src="js/jquery.zclip.min.js"></script>
    <script type="text/javascript" language="JavaScript" src="js/posttool_ds.js"></script>
    <script type="text/javascript" language="JavaScript" >
      config= {
        snippets: {
          'char': ':ds: [color=blue][b][size=12pt]{text}[/size][/b][/color]\n',
          'ooc' : '[color=red][size=8pt][i]OOC: {text}[/i][/size][/color]\n'
        }

      }



      //update source field
      function updateSource() {
        var source;

        source='';
        $('#sortableSaylist').children().each(
          function(index){
            source+= decodeURI($(this).attr('source'));
          }
        );

        $('#textSource').html(source);
        //console.log(source);
      }

      //build a text brick
      function createTextBrick(text, source, colour) {
        textbrick= $('<li class="ui-state-default ui-corner-all">');
        textbrick.attr('source', encodeURI(source));
        textbrick.append('<span class="ui-icon ui-icon-arrowthick-2-n-s front">');
        textbrick.append($('<span style="color:'+colour+';">').text(text));
        textbrick.append('<span class="ui-icon ui-icon-close floatright back2">');
        textbrick.append('<span class="ui-icon ui-icon-pencil floatright back1">');
        textbrick.appendTo($('#sortableSaylist'));
        return textbrick;
      }

      function createCode_Char(text) {
        return config.snippets['char'].replace('/\{text\}/', text);
      };

      function createCode_OOC (text) {
        return config.snippets['ooc'].replace('/\{text\}/', text);
      };


      // setup UI events
      $(document).ready(function(){

        // buttons
        $("#post").button().zclip({
            path: 'js/ZeroClipboard.swf',
            copy: function(){
              return $('#textSource').html();
            },
            afterCopy: function(){
              //override alert box
              //console.log($('#textSource').html());
            }
        });

        $('#add').button().click(function(){
            $( "#dialog-form" ).dialog( "open" );
        });


/*
        // character name button
        $("#charname").button().click(function(){
            $( "#dialog-form" ).dialog( "open" );

            var input;
            
            input= $('#textChar').val();

            $('#sortableSaylist').append(
              createTextBrick(
                input,
                createCode_Char(input),
                'blue'
              )
            );

            updateSource();
        });

        // Out of character button
        $("#ooc").button().click(function(){
            var input;

            input= $('#textChar').val();

            $('#sortableSaylist').append(
              createTextBrick(
                input,
                createCode_OOC(input),
                'red'
              )
            );

            updateSource();
        });
*/




        // Sortable
        $( "#sortableSaylist").sortable({
            placeholder: "ui-state-highlight",
            change: function(event, ui) {
              updateSource();
            }
        });
        $( "#sortableSaylist").disableSelection();

        $('#sortableSaylist li span.back1').click(function(){
          alert('edit');

        });

        $('#sortableSaylist li span.back2').click(function(event){
          node= $(event.currentTarget.parentNode);
          //alert('delete  ' + node.text());
          node.remove();
        });

        $('input#type').change(function(){
            // do something to set buttons correctly

            var type= $('input#type').val();
            console.log($('dev.ui-dialog-buttonset'));

            $('dev.ui-dialog-buttonset').children().removeClass('ui-state-selected');
            $('span.ui-button-text:contains("'+type+'")').parent().addClass('ui-state-selected');

            console.log('Type change:', type);
        });


        $("#dialog-form").dialog({
          autoOpen: false,
          height: 140,
          width: 570,
          modal: true,
          buttons: {
            'Character name': function(event) {
              $('input#type').val('Character name');
              $('input#type').change();
            },
            'OOC': function() {
              $('input#type').val('OOC');
              $('input#type').change();
            },
            'Say': function() {
              $('input#type').val('Say');
              $('input#type').change();
            },
            'Think': function() {
              $('input#type').val('Think');
            },
            'Roll': function() {
              $('input#type').val('Roll');
              $('input#type').change();
            },
            'Plain': function() {
              $('input#type').val('Plain');
              $('input#type').change();
            },
            "Save Brick": function() {
               $(this).dialog("close");
            },
            Cancel: function() {
              $(this).dialog("close");
            }
          },
          create: function(event, ui) {
            // fix button pane
            $('span.ui-button-text:contains("Plain")').parent().css('margin-right', '25px');
            $('input#type').val('Character name');
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="wrapper">
      <div class="posttool">
        <ul id="sortableSaylist" class='ui-widget ui-widget-content ui-corner-all'>
        </ul>
        <div id="right">
          <a id="add" class="button">Add text brick</a>
          <a id="post" class="button">Copy to clipboard</a>
          <a id="view" class="button">View Source</a>
        </div>
      </div>
    </div>

    <div id="dialog-form" title="Add/Edit text brick">
      <form>
        <input type="hidden" id="type" value="char"/>
        <textarea id="textPlain" rows=2 cols=83></textarea>
        <div style="display:none">
          <textarea id="foo" rows=2 cols=83></textarea>
        </div>
      </form>
    </div>
  </body>
</html>
